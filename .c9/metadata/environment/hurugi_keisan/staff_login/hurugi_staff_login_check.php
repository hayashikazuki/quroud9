{"changed":false,"filter":false,"title":"hurugi_staff_login_check.php","tooltip":"/hurugi_keisan/staff_login/hurugi_staff_login_check.php","value":"<?php\n\ntry\n{\n    \nrequire_once('../common/common.php');\n    \n$post = sanitize($_POST);\n$staff_code = $post['code'];\n$staff_pass = $post['pass'];\n  \n$staff_pass = md5($staff_pass);\n\n$dsn = 'mysql:dbname=king_hp_contact;host=localhost;charset=utf8';\n$user = 'root';\n$password = '';\n$dbh = new PDO($dsn,$user,$password);\n$dbh->setAttribute(PDO::ATTR_ERRMODE,PDO::ERRMODE_EXCEPTION);\n\n$sql = 'SELECT name FROM hurugi_staff WHERE code=? AND password=?';\n$stmt = $dbh->prepare($sql);\n$data[] = $staff_code;\n$data[] = $staff_pass;\n$stmt->execute($data);\n\n$dbh = null;\n\n$rec = $stmt->fetch(PDO::FETCH_ASSOC);\n\n\nif($rec == false)\n{\n    print'スタッフコードかパスワードが間違っています。<br />';\n    print'<a href=\"staff_login.html\">戻る</a>';\n    \n    var_dump($data);\n}\nelse\n{   \n    session_start();\n    $_SESSION['login']=1;\n    $_SESSION['staff_code']=$staff_code;\n    $_SESSION['staff_name']=$rec['name'];\n    header('Location:../info/king_info_list.php');\n    exit();\n}\n   \n}\ncatch(Exception $e)\n{\n    print'ただいま障害により大変ご迷惑をお掛けしております。';\n    exit();\n}\n\n\n\n?>","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":108,"scrollleft":0,"selection":{"start":{"row":19,"column":31},"end":{"row":19,"column":31},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":5,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1594726005905}